#!/usr/bin/python

import sys
import urllib

path = 'http://football.iernst.net/manage/quick_add?'
def add_player(name, email, entries):
    args = {
        'player': name,
        'email': email,
    }
    for i,entry in enumerate(entries):
        args['entry%d' % i] = entry
    url = path + '&'.join('%s=%s' % (k,urllib.quote_plus(v)) for k,v in args.iteritems())
    print 'opening: %s' % url
    req = urllib.urlopen(url)
    if req.getcode() != 200:
        raise Exception('Error uploading for player %s', name)

players = open(sys.argv[1], 'r')

name = None
email = None
entries = []
for line in players:
    print 'Parsing line: %s' % line.strip()
    parts = line.split(',')

    if len(parts) == 3:
        if name is not None:
            # new player, send last one
            add_player(name, email, entries)
        name = parts[0].strip()
        email = parts[2].strip()
        entries = []
    entries.append(parts[1].strip())

add_player(name, email, entries)

